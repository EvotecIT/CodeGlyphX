@using CodeGlyphX

@if (Host is null)
{
    <div class="card">
        <h2>Preview</h2>
        <p>Loading...</p>
    </div>
}
else
{
    <div class="card">
        <h2>@(Host.SelectedMode == "Decode" ? "Decode Result" : "Preview")</h2>
        <div class="output-preview">
            @if (!string.IsNullOrEmpty(Host.ErrorMessage))
            {
                <div style="text-align: center; color: #ef4444;">
                    <p style="font-size: 2rem; margin-bottom: 0.5rem;">âš </p>
                    <p>@Host.ErrorMessage</p>
                </div>
            }
            else if (Host.SelectedMode == "Decode" && !string.IsNullOrEmpty(Host.DecodeImageDataUri))
            {
                <img src="@Host.DecodeImageDataUri" alt="Uploaded code" />
            }
            else if (Host.SelectedMode == "Generate" && !string.IsNullOrEmpty(Host.ImageDataUri))
            {
                <img src="@Host.ImageDataUri" alt="Generated code" />
            }
            else
            {
                <div style="text-align: center; color: var(--text-muted);">
                    <p style="font-size: 2rem; margin-bottom: 0.5rem;">ðŸ“±</p>
                    <p>@(Host.SelectedMode == "Decode" ? "Upload an image to decode" : "Enter content to generate a code")</p>
                </div>
            }
        </div>

        @if (Host.SelectedMode == "Generate" && !string.IsNullOrEmpty(Host.ImageDataUri))
        {
            <div class="download-buttons">
                <a href="@Host.ImageDataUri" download="@Host.GetDownloadFilename("png")" class="btn btn-secondary">
                    Download PNG
                </a>
                @if (!string.IsNullOrEmpty(Host.SvgDataUri))
                {
                    <a href="@Host.SvgDataUri" download="@Host.GetDownloadFilename("svg")" class="btn btn-secondary">
                        Download SVG
                    </a>
                }
            </div>
        }

        @if (Host.SelectedMode == "Generate" && Host.SelectedCategory == "QR" && Host.SafetyReport is not null && !string.IsNullOrEmpty(Host.ImageDataUri))
        {
            <div style="margin-top: 1.25rem; border: 1px solid rgba(148,163,184,0.25); border-radius: 12px; padding: 0.85rem;">
                <div style="display: flex; align-items: center; justify-content: space-between; gap: 0.75rem;">
                    <div>
                        <strong>Scan safety</strong>
                        <span style="margin-left: 0.5rem; font-size: 0.85rem; color: @Host.GetSafetyColor();">@Host.GetSafetyStatus()</span>
                    </div>
                    <div style="font-weight: 600; color: @Host.GetSafetyColor();">@Host.SafetyReport.Score/100</div>
                </div>
                <div style="height: 6px; background: rgba(148,163,184,0.25); border-radius: 999px; overflow: hidden; margin-top: 0.5rem;">
                    <div style="height: 100%; width: @Host.SafetyReport.Score%; background: @Host.GetSafetyColor();"></div>
                </div>
                @if (Host.SafetyReport.Warnings.Length > 0)
                {
                    <ul style="color: var(--text-muted); margin: 0.65rem 0 0 1rem;">
                        @foreach (var warning in Host.SafetyReport.Warnings)
                        {
                            <li>@warning.Message</li>
                        }
                    </ul>
                }
                else
                {
                    <p style="color: var(--text-muted); margin: 0.65rem 0 0 0;">No scan risks detected.</p>
                }
            </div>
        }

        @if (Host.SelectedMode == "Decode")
        {
            <div style="margin-top: 1.5rem;">
                @if (!string.IsNullOrEmpty(Host.DecodeError))
                {
                    <p style="color: #ef4444;">@Host.DecodeError</p>
                }
                else if (Host.DecodeResults.Count > 0)
                {
                    <ul style="color: var(--text-muted); margin-left: 1.25rem;">
                        @foreach (var result in Host.DecodeResults)
                        {
                            <li><strong>@result.Type</strong>: @result.Text</li>
                        }
                    </ul>
                }
                else if (!string.IsNullOrEmpty(Host.DecodeImageDataUri))
                {
                    <p style="color: var(--text-muted);">No codes detected.</p>
                }
            </div>
        }
    </div>
}

@code {
    [CascadingParameter]
    public Playground? Host { get; set; }
}
