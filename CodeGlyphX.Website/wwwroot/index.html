<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <base href="/" />
  <title>CodeGlyphX</title>
  <meta name="description" content="CodeGlyphX is a blazing-fast, zero-dependency .NET library for generating and decoding QR codes, barcodes, Data Matrix, PDF417, and Aztec codes." />
  <link rel="icon" type="image/png" href="codeglyphx-qr-icon.png" />
  <link rel="apple-touch-icon" href="codeglyphx-qr-icon.png" />
  <script>(function(){const t=localStorage.getItem('theme')||'auto';document.documentElement.dataset.theme=t;})();</script>
  <link rel="stylesheet" href="css/app.css" />
</head>
<body>
  <div id="app">
    <div class="loading">
      <div class="loading-content">
        <div class="loading-spinner"></div>
        <p>Loading CodeGlyphX...</p>
      </div>
    </div>
  </div>
  <div id="blazor-error-ui">
    <span>Something went wrong.</span>
    <a href="" class="reload">Reload</a>
    <a class="dismiss">Ã—</a>
  </div>
  <script src="js/site.js"></script>
  <script>
    (function () {
      if (typeof window.fetch !== 'function') {
        return;
      }

      const originalFetch = window.fetch.bind(window);

      function isFrameworkRequest(input, init) {
        const method = ((init && init.method) || 'GET').toString().toUpperCase();
        if (method !== 'GET') {
          return false;
        }

        const rawUrl = typeof input === 'string'
          ? input
          : (input && typeof input.url === 'string' ? input.url : '');
        if (!rawUrl) {
          return false;
        }

        try {
          const resolved = new URL(rawUrl, window.location.href);
          return resolved.pathname.includes('/_framework/');
        } catch {
          return rawUrl.includes('/_framework/');
        }
      }

      function withRetryHint(url, attempt) {
        try {
          const resolved = new URL(url, window.location.href);
          resolved.searchParams.set('_pfretry', String(attempt));
          return resolved.toString();
        } catch {
          return url;
        }
      }

      function delay(ms) {
        return new Promise((resolve) => setTimeout(resolve, ms));
      }

      window.fetch = async function (input, init) {
        if (!isFrameworkRequest(input, init)) {
          return originalFetch(input, init);
        }

        const maxAttempts = 4;
        let lastError = null;

        for (let attempt = 1; attempt <= maxAttempts; attempt++) {
          try {
            let requestInput = input;
            if (attempt > 1) {
              const rawUrl = typeof input === 'string'
                ? input
                : (input && typeof input.url === 'string' ? input.url : '');
              if (rawUrl) {
                requestInput = withRetryHint(rawUrl, attempt);
              }
            }

            const response = await originalFetch(requestInput, init);
            if (response.status < 500 || response.status >= 600) {
              return response;
            }

            lastError = new Error('Framework resource returned HTTP ' + response.status + '.');
          } catch (error) {
            lastError = error;
          }

          if (attempt < maxAttempts) {
            const baseDelay = Math.min(250 * Math.pow(2, attempt - 1), 2000);
            const jitter = Math.floor(Math.random() * 120);
            await delay(baseDelay + jitter);
          }
        }

        if (lastError) {
          throw lastError;
        }

        return originalFetch(input, init);
      };
    })();
  </script>
  <script src="_framework/blazor.webassembly.js"></script>
</body>
</html>
