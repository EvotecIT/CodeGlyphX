@page "/playground"
@using Microsoft.AspNetCore.Components.WebAssembly.Services
@inject LazyAssemblyLoader AssemblyLoader

<PageTitle>Playground - CodeGlyphX</PageTitle>

<div class="playground">
    @if (_loadError != null)
    {
        <div class="card">
            <h2>Playground unavailable</h2>
            <p>@_loadError</p>
        </div>
    }
    else if (_playgroundType == null)
    {
        <div class="card">
            <h2>Loading playground...</h2>
            <p>Downloading the CodeGlyphX engine. This is only required the first time you open the playground.</p>
        </div>
    }
    else
    {
        <DynamicComponent Type="_playgroundType" />
    }
</div>

@code {
    private Type? _playgroundType;
    private string? _loadError;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            await AssemblyLoader.LoadAssembliesAsync(new[]
            {
                "CodeGlyphX.Playground.wasm",
                "CodeGlyphX.wasm"
            });

            _playgroundType = Type.GetType("CodeGlyphX.Playground.Playground, CodeGlyphX.Playground");
            if (_playgroundType is null)
                _loadError = "Playground component failed to load.";
            StateHasChanged();
        }
        catch (Exception ex)
        {
            _loadError = ex.Message;
            StateHasChanged();
        }
    }
}
