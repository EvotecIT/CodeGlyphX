# CodeGlyphX Website Plan

This plan focuses on real Lighthouse/PageSpeed findings and the current hosting model
(GitHub Pages + Cloudflare). It is ordered from highest impact / lowest risk to
larger structural changes.

## Current Reality
- Home is static HTML, while Docs and Playground are Blazor WASM builds at `/docs/` and `/playground/`.
- API docs are static JSON/HTML in `wwwroot/api/` and are served under `/docs/api/`.
- The publish script strips `.br`/`.gz` and rewrites `blazor.boot.json` integrity hashes.
- GitHub Pages controls cache headers; long TTL requires Cloudflare rules.
- Navigation/footers are sourced from `CodeGlyphX.Website/wwwroot/data/site-nav.json` and synced into static fragments via `Build/Update-NavFragments.ps1`.
- Source of truth for FAQ/Showcase data is `Assets/Data/*.json`. Build copies those into `CodeGlyphX.Website/wwwroot/api/` so SPA fetches never 404.
- `llms.txt`, `llms-full.txt`, and `sitemap.xml` are generated by `Build/Build-Website.ps1` (or `Build/Generate-Llms.ps1` + `Build/Generate-Sitemap.ps1`).
- Style-board images under `CodeGlyphX.Website/wwwroot/assets/style-board/` are generated by `Build/Update-StyleBoard.ps1`.

## Priority 0: Fix What PageSpeed Flags (No Architecture Change)

### 0.1 Image dimensions (CLS)
**Problem**: Lighthouse flags images without explicit width/height.
**Fix**:
- Add `width` attributes for shields.io badges and logo.
- Use `srcset` or explicit sizes for logo in nav/footer.

### 0.2 Contrast + link distinction (Accessibility)
**Problem**: Low contrast in code comments and muted text; links rely on color alone.
**Fix**:
- Increase contrast for `.comment` and muted body text.
- Add underline or weight change on links (or icon) so they are distinguishable.

### 0.3 Heading order (Accessibility)
**Problem**: Heading levels skip (e.g., `h3` before `h2`).
**Fix**:
- Audit Home + Docs + Footer headings and enforce sequential order.

### 0.4 Reduce render-blocking CSS
**Problem**: `app.css` and `fonts.css` block first render.
**Fix**:
- Inline critical CSS in `index.html` (base layout + hero).
- Defer `fonts.css` with `rel=preload` + `onload`.

### 0.5 Reduce font cost + improve LCP
**Problem**: Many Inter weights, JetBrains font loads early, slow LCP.
**Fix**:
- Keep only 2-3 Inter weights (400/600/700).
- Add `font-display: swap`.
- Preload only the single critical font (Inter 600).

## Priority 1: Performance Improvements (Same Architecture)

### 1.1 Cache lifetimes (CDN)
**Problem**: GitHub Pages cache TTL is short (4h) and triggers warnings.
**Fix**:
- Add Cloudflare cache rules for:
  - `/_framework/*`, `/fonts/*`, `/css/*`, `/api/*`
  - Cache TTL: 1 year, "Ignore Query String"
- Keep `index.html` short TTL.

### 1.2 Reduce JS time (TBT)
**Problem**: `blazor.webassembly.js` dominates CPU time.
**Fix**:
- Keep minimal UI JS on non-interactive pages.
- Delay code highlighting and DOM scans to idle time.

### 1.3 Remove forced reflow sources
**Problem**: Forced reflow shows in Lighthouse.
**Fix**:
- Avoid reading layout immediately after writing styles in JS.
- If syntax highlight runs, do it after first paint.

## Priority 2: Structural Split (Big Win)

### 2.1 Split SPA into static + WASM
**Goal**: Static Home, WASM only where needed.
**Approach (current)**:
- Home is static at `/`.
- Docs are WASM at `/docs/` (dynamic routing + sidebar state).
- Playground is WASM at `/playground/`.
- API reference is static under `/docs/api/`.

### 2.2 Service worker scope
**Goal**: SW should not control the whole site.
**Fix (current)**:
- Service worker is scoped to each WASM base (`/docs/`, `/playground/`).

## Priority 3: UX and Content Polish

### 3.1 Make API reference resilient
**Problem**: 404 on `/api/index.json` if docs not present.
**Fix**:
- Show friendly fallback message and link to GitHub if JSON missing.

### 3.2 Improve hero and CTA clarity
**Fix**:
- Ensure CTA contrast and focus state is accessible.
- Avoid low contrast on code snippets.

## Checklist: What to Change Now
- [x] Add width/height for badges and logo.
- [x] Increase contrast for code comments + muted text.
- [x] Add underline or icon for external links.
- [x] Normalize heading levels across pages.
- [x] Defer `fonts.css` (preload + onload).
- [ ] Inline critical CSS for the hero + header.
- [x] Reduce font weights + preload one weight.
 - [x] Add `favicon.ico` to avoid browser 404s.
 - [x] Ensure boot.json integrity is updated after stripping `.br`/`.gz`.

## Checklist: Structural Split
- [x] Create static `site/` output for Home + API reference.
- [x] Publish WASM under `/playground/`.
- [x] Update navigation links (no route changes).
- [x] Scope service workers to `/docs/` and `/playground/`.
- [x] Add build-specific routing for `/docs/` and `/playground/`.

## Checklist: Content & Features
- [x] Add Showcase section featuring AuthIMO as real-world example.
- [x] Add copy buttons to code blocks (docs, API reference, playground).
- [ ] Retake AuthIMO screenshots for website-ready quality (clean backgrounds, consistent sizing).
- [ ] Add AuthIMO download links once releases are published (.msi, portable .exe).

## Notes
- This plan assumes we keep Blazor for the interactive playground only.
- GitHub Pages cannot set cache headers; Cloudflare rules are required.

## Reuse Across Projects (50+ repos)
Goal: make this a repeatable, low‑effort website stack.

### Reusable Assets to Standardize
- **Website build template**: shared PowerShell scripts for API docs + sitemap + llms outputs.
- **Pages workflow template**: single YAML that publishes static root + `/playground/` WASM.
- **CSS/HTML baseline**: shared nav/footer/badges + accessibility defaults.
- **Perf defaults**: font preload/defer, image dimensions, contrast rules.
- **Cloudflare cache rules**: one standard rule set per domain.

### Checklist to Productize
- [ ] Extract build scripts to a reusable `Build/Website.Common.ps1`.
- [ ] Add a `templates/website/` folder with base layout + styles.
- [ ] Add a pre‑publish validation script (headings order, image sizes, link styles).
- [ ] Document “drop‑in” steps for new repos (5‑10 min setup).
